{% extends layout %}
{% load resource_extras %}
{% block favicon %}{{ item_type|icon_url:16 }}{% endblock %}
{% block title %}<img src="{{ item_type|icon_url:48 }}" /> {{ item }} Permissions{% endblock %}
{% block content %}

<script src="http://ajax.googleapis.com/ajax/libs/prototype/1.6.0.2/prototype.js"></script>

<div class="crumbs">
    {% for inherited_item_type in item_type_inheritance %}
    <a href="/resource/{{ inherited_item_type|lower }}">{{ inherited_item_type }}s</a>
    &raquo;
    {% endfor %}
    <a href="{% show_resource_url item %}">{{ item }}</a>
    &raquo;
    Permissions
</div>

<table class="list">
    <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Permissions</th>
    </tr>
    {% for agent_datum in agent_data %}
    <tr class="{% cycle 'even' 'odd' as row_parity %}">
        <td>Agent</td>
        <td><a href="{% show_resource_url agent_datum.agent %}">{{ agent_datum.agent.name }}</a></td>
        <td>
            {% for p in agent_datum.role_permissions %}
                <div><a href="{% show_resource_url p %}">{{ p.role.name }}</a></div>
            {% endfor %}
            {% for p in agent_datum.permissions %}
                <div><a href="{% show_resource_url p %}">{% if p.is_allowed %}+{% else %}-{% endif %}{{ p.ability }}({{ p.ability_parameter }})</a></div>
            {% endfor %}
            <div><a href="#" onclick="$('role_permission_form_{{ agent_datum.agent.pk }}').toggle(); return false;">[New Role Permission]</a></div>
            <div id="role_permission_form_{{ agent_datum.agent.pk }}" style="display: none;">
                <form method="post" enctype="multipart/form-data" action="/resource/item/{{ item.pk }}/permissioncreate?formtype=agentrolepermission&redirect={{ full_path|urlencode }}&formprefix={{ agent_datum.role_permission_form.prefix|urlencode }}" class="item_form">
                    <table>
                        {{ agent_datum.role_permission_form.as_table }}
                    </table>
                    <input type="submit" />
                </form>
            </div>
            <div><a href="#" onclick="$('permission_form_{{ agent_datum.agent.pk }}').toggle(); return false;">[New Permission]</a></div>
            <div id="permission_form_{{ agent_datum.agent.pk }}" style="display: none;">
                <form method="post" enctype="multipart/form-data" action="/resource/item/{{ item.pk }}/permissioncreate?formtype=agentpermission&redirect={{ full_path|urlencode }}&formprefix={{ agent_datum.permission_form.prefix|urlencode }}" class="item_form">
                    <table>
                        {{ agent_datum.permission_form.as_table }}
                    </table>
                    <input type="submit" />
                </form>
            </div>
        </td>
    </tr>
    {% endfor %}
    {% for group_datum in group_data %}
    <tr class="{% cycle row_parity %}">
        <td>Group</td>
        <td><a href="{% show_resource_url group_datum.group %}">{{ group_datum.group.name }}</a></td>
        <td>
            {% for p in group_datum.role_permissions %}
                <div><a href="{% show_resource_url p %}">{{ p.role.name }}</a></div>
            {% endfor %}
            {% for p in group_datum.permissions %}
                <div><a href="{% show_resource_url p %}">{% if p.is_allowed %}+{% else %}-{% endif %}{{ p.ability }}({{ p.ability_parameter }})</a></div>
            {% endfor %}
            <div><a href="#" onclick="$('role_permission_form_{{ group_datum.group.pk }}').toggle(); return false;">[New Role Permission]</a></div>
            <div id="role_permission_form_{{ group_datum.group.pk }}" style="display: none;">
                <form method="post" enctype="multipart/form-data" action="/resource/item/{{ item.pk }}/permissioncreate?formtype=grouprolepermission&redirect={{ full_path|urlencode }}&formprefix={{ group_datum.role_permission_form.prefix|urlencode }}" class="item_form">
                    <table>
                        {{ group_datum.role_permission_form.as_table }}
                    </table>
                    <input type="submit" />
                </form>
            </div>
            <div><a href="#" onclick="$('permission_form_{{ group_datum.group.pk }}').toggle(); return false;">[New Permission]</a></div>
            <div id="permission_form_{{ group_datum.group.pk }}" style="display: none;">
                <form method="post" enctype="multipart/form-data" action="/resource/item/{{ item.pk }}/permissioncreate?formtype=grouppermission&redirect={{ full_path|urlencode }}&formprefix={{ group_datum.permission_form.prefix|urlencode }}" class="item_form">
                    <table>
                        {{ group_datum.permission_form.as_table }}
                    </table>
                    <input type="submit" />
                </form>
            </div>
        </td>
    </tr>
    {% endfor %}
    <tr class="{% cycle row_parity %}">
        <td>Default</td>
        <td></td>
        <td>
            {% for p in default_data.role_permissions %}
                <div><a href="{% show_resource_url p %}">{{ p.role.name }}</a></div>
            {% endfor %}
            {% for p in default_data.permissions %}
                <div><a href="{% show_resource_url p %}">{% if p.is_allowed %}+{% else %}-{% endif %}{{ p.ability }}({{ p.ability_parameter }})</a></div>
            {% endfor %}
            <div><a href="#" onclick="$('role_permission_form_default').toggle(); return false;">[New Role Permission]</a></div>
            <div id="role_permission_form_default" style="display: none;">
                <form method="post" enctype="multipart/form-data" action="/resource/item/{{ item.pk }}/permissioncreate?formtype=defaultrolepermission&redirect={{ full_path|urlencode }}&formprefix={{ default_data.role_permission_form.prefix|urlencode }}" class="item_form">
                    <table>
                        {{ default_data.role_permission_form.as_table }}
                    </table>
                    <input type="submit" />
                </form>
            </div>
            <div><a href="#" onclick="$('permission_form_default').toggle(); return false;">[New Permission]</a></div>
            <div id="permission_form_default" style="display: none;">
                <form method="post" enctype="multipart/form-data" action="/resource/item/{{ item.pk }}/permissioncreate?formtype=defaultpermission&redirect={{ full_path|urlencode }}&formprefix={{ default_data.permission_form.prefix|urlencode }}" class="item_form">
                    <table>
                        {{ default_data.permission_form.as_table }}
                    </table>
                    <input type="submit" />
                </form>
            </div>
        </td>
    </tr>
</table>

<div>
    <div>New Agent</div>
    <form method="get" class="item_form">
        <table>
            {{ new_agent_form.as_table }}
        </table>
        <input type="submit" />
    </form>
</div>

<div>
    <div>New Group</div>
    <form method="get" class="item_form">
        <table>
            {{ new_group_form.as_table }}
        </table>
        <input type="submit" />
    </form>
</div>

{% endblock content %}

