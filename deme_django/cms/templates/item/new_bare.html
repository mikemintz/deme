{% load item_tags %}
{% if is_html %}
<script type="text/javascript" src="{% media_url "javascripts/tinymce/jscripts/tiny_mce/tiny_mce.js" %}"></script>
<script type="text/javascript">
$(document).ready(function () {
    tinyMCE.init({
        // General options
        mode: "exact",
        elements: "body",
        theme : "advanced",
        plugins : "table,advimage,advlink,media,paste,fullscreen,xhtmlxtras,searchreplace",

        // Theme options
        theme_advanced_buttons1 : "bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,formatselect,fontselect,fontsizeselect,|,search,replace",
        theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,bullist,numlist,|,outdent,indent,blockquote,|,cite,abbr,acronym,|,undo,redo,|,link,unlink,anchor,image,cleanup,code,|,forecolor,backcolor",
        theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,|,sub,sup,|,charmap,media,|,fullscreen",
        theme_advanced_toolbar_location : "top",
        theme_advanced_toolbar_align : "left",
        theme_advanced_statusbar_location : "bottom",
        theme_advanced_resizing : true,
        convert_urls : false,
    });
});
</script>
<script>
$(function(){
  $('.tooltip-trigger').tooltip();
});
</script>
{% endif %}

<div style="border: thin solid #aaa; background: #eee; padding: 10px; margin-bottom: 10px;" class="item-type-container">
    {% for item_type in item_types %}
    <span>
    {% ifequal item_type.item_type accepted_item_type %}
    <b>New {{ item_type.name|capfirst }}</b>
    {% else %}
      {% with item_type.item_type|to_name as accepted_item_type_name %}
      {% with "create "|add:accepted_item_type_name as create_permission %}
      {% ifagentcanglobal create_permission  %}
        <a href="{% url item_type_url viewer=item_type.viewer,action="new" %}?{{ query_string }}">New {{ item_type.name|capfirst }}</a>
      {% else %}
        <b class="disabled" data-toggle="tooltip" title="You do not have permission to create this type of item" class="tooltip-trigger">New {{ item_type.name|capfirst }}</b>
      {% endifagentcanglobal %}
      {% endwith %}
      {% endwith %}
    {% endifequal %}
    </span>
    {% endfor %}
</div>

<div class="item-type-new-container">
{% if form %}
    <form method="post" enctype="multipart/form-data" action="{% url item_type_url viewer=viewer_name,action="create" %}?{% if add_to_collection %}add_to_collection={{ add_to_collection|urlencode }}&{% endif %}{% if redirect %}redirect={{ redirect|urlencode }}{% endif %}{% if modal %}&modal=1{% endif %}{% if receiver_input_id %}&id={{ receiver_input_id }}{% endif %}{% if src %}&src={{ src }}{% endif %}" class="item_form">
        <table cellspacing="0">
           {{ form.as_table }}
        </table>
        <p>
            <button type="button" class="btn btn-default" onclick="$('#permission_editor').toggle();"><i class="glyphicon glyphicon-lock"></i> Permissions</button>
        </p>
        <div id="permission_editor" style="display: none;">
            {% new_item_permission_editor item %}
        </div>
        <p>
        <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Create {{ accepted_item_type_name }}</button></p>
        {% if receiver_input_id %}
        <input type="hidden" name="receiver_input_id" value="{{ receiver_input_id }}">
        {% endif %}
        {% if src %}
        <input type="hidden" name="src" value="{{ src }}">
        {% endif %}
    </form>
{% else %}
    {% if item_types|length > 1 %}
    Please choose {{ accepted_item_type_name|an }} {{ accepted_item_type_name }}.
    {% else %}
    You do not have permission to create {{ accepted_item_type_name_plural }}. <a href="javascript:history.back()">Go back</a>
    {% endif %}
{% endif %}
</div>

