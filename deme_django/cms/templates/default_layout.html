{% load item_tags %}{% load chat_extras %}<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">

    {% if item %}
    <title>Deme &raquo; {% viewable_name item %}{% if action_title %} &raquo; {{ action_title }}{% endif %}</title>
    {% else %}
    <title>Deme{% if action_title %} &raquo; {{ action_title }}{% endif %}</title>
    {% endif %}


    <link rel="shortcut icon" href="{% block favicon %}{% if item %}{{ item.actual_item_type|icon_url:24 }}{% else %}{{ accepted_item_type|icon_url:24 }}{% endif %}{% endblock favicon %}" type="image/x-icon" />
    <!--<link rel="shortcut icon" href="{% media_url "favicon.ico" %}" type="image/x-icon" />-->

    {% universal_edit_button %}

    <!--link rel="stylesheet" href="{% media_url "stylesheets/blueprint/screen.css" %}" type="text/css" media="screen, projection" />
    <link rel="stylesheet" href="{% media_url "stylesheets/blueprint/print.css" %}" type="text/css" media="print" /-->

    <!--[if IE]>
        <!--link rel="stylesheet" href="{% media_url "stylesheets/blueprint/ie.css" %}" type="text/css" media="screen, projection" /-->
    <![endif]-->
    <link href="{% media_url "css/deme.css" %}" rel="stylesheet">
    <link href="{% media_url "stylesheets/base.css" %}" media="all" rel="Stylesheet" type="text/css" />

    <script type="text/javascript" src="{% media_url "javascripts/jquery-1.7.2.min.js" %}"></script>

    <script type="text/javascript" src="{% media_url "javascripts/jquery.cookie.js" %}"></script>

    <script type="text/javascript" src="{% media_url "javascripts/jquery-ui-1.8.21.custom.min.js" %}"></script>
    <script type="text/javascript" src="{% media_url "javascripts/bootstrap.min.js" %}"></script>
    <link href="{% media_url "stylesheets/smoothness/jquery-ui-1.8.21.custom.css" %}" media="all" rel="Stylesheet" type="text/css" />

    <script type="text/javascript" src="{% media_url "javascripts/grid.locale-en.js" %}"></script>
    <script type="text/javascript" src="{% media_url "javascripts/jquery.jqGrid.min.js" %}"></script>
    <link href="{% media_url "stylesheets/ui.jqgrid.css" %}" media="all" rel="Stylesheet" type="text/css" />

    <script type="text/javascript" src="{% media_url "javascripts/fg.menu.js" %}"></script>

    <script type="text/javascript" src="{% media_url "javascripts/deme/adminbar.js" %}"></script>
    <script type="text/javascript" src="{% media_url "javascripts/deme/metabar.js" %}"></script>

    <script type="text/javascript">
            $(document).ready(function () {
                $('#showhidetarget').hide();

                $('a#showhidetrigger').click(function () {
                    $('#showhidetarget').toggle(400);

                    if($.browser.safari)
                    {
                    $("#showhidetarget").html("<p>For Safari users: Safari currently does not support the ability to go fullscreen.</p>");
                    }
                    if($.browser.mozilla)
                    {
                    $("#showhidetarget").html("<p>For Firefox user: Click on the View menu, located at the top of your browser window. When the drop-down menu appears, select the option labeled Full Screen.</p>");
                    }
                    if($.browser.msie)
                    {
                    $("#showhidetarget").html("<p>For Internet Explorer users: Click on the Tools menu, located at the top of your browser window. When the drop-down menu appears, select the option labeled Full Screen.</p>");

                    }
                    if(navigator.userAgent.toLowerCase().indexOf('chrome') > -1)
                    {
                    $("#showhidetarget").html("<p>For Chrome users: Click on the Chrome \"wrench\" icon, located in the upper right hand corner of your browser window. When the drop-down menu appears, select the choice labeled Full Screen.</p>");
                    }
                    return false;
                });
            });
        </script>


        </script>
    <link href="{% media_url "stylesheets/fg.menu.css" %}" media="screen" rel="stylesheet" type="text/css" />
    <!-- style exceptions for IE 6 -->
    <!--[if IE 6]>
    <style type="text/css">
        .fg-menu-ipod .fg-menu li { width: 95%; }
        .fg-menu-ipod .ui-widget-content { border:0; }
    </style>
    <![endif]-->

    {% if item %}
    <link rel="alternate" type="application/rss+xml" title="Action notice feed" href="{% url item_url viewer=viewer_name,action="show",noun=item.pk,format="rss" %}" />
    {% endif %}
    {% ifequal action 'list' %}
    <link rel="alternate" type="application/rss+xml" title="Item feed" href="{% url item_type_url viewer=viewer_name,action="list",format="rss" %}" />
    {% endifequal %}
    <script type="text/javascript">
        // from http://www.filamentgroup.com/examples/buttonFrameworkCSS/
        $(function(){
            //all hover and click logic for buttons
            $(".fg-button:not(.ui-state-disabled)")
            .hover(
                function(){
                    $(this).addClass("ui-state-hover");
                },
                function(){
                    $(this).removeClass("ui-state-hover");
                }
            )
            .mousedown(function(){
                    $(this).parents('.fg-buttonset-single:first').find(".fg-button.ui-state-active").removeClass("ui-state-active");
                    if( $(this).is('.ui-state-active.fg-button-toggleable, .fg-buttonset-multi .ui-state-active') ){ $(this).removeClass("ui-state-active"); }
                    else { $(this).addClass("ui-state-active"); }
            })
            .mouseup(function(){
                if(! $(this).is('.fg-button-toggleable, .fg-buttonset-single .fg-button,  .fg-buttonset-multi .fg-button') ){
                    $(this).removeClass("ui-state-active");
                }
            });
        });

        // To give the gray "Search" text in the search box
        $(document).ready(function () {
            var search_box_changed = {% if search_query %}true{% else %}false{% endif %};
            var search_box = document.getElementById('search_box');
            search_box.onfocus = function(e){
                if (!search_box_changed) {
                    search_box_changed = true;
                    search_box.value = '';
                    search_box.style.color = 'inherit';
                }
            };
            search_box.onblur = function(e){
                if (search_box.value == '') {
                    search_box_changed = false;
                    search_box.value = 'Search';
                    search_box.style.color = '#777';
                }
            };
            search_box.onblur();

            var cache = {};
            var last_xhr;
            $(search_box).autocomplete({
                minLength: 0,
                select: function(event, ui) {
                    window.location.href = ui.item.url;
                },
                source: function(request, response) {
                    var term = request.term;
                    if (term in cache) {
                        response(cache[term]);
                        return;
                    }
                    last_xhr = $.getJSON('{% url item_type_url viewer="item",action="grid",format="json" %}', {rows:10, page:1, sidx:"name", sord:"asc", fields:"name", searchOper:"cn", searchField:"name", searchString:term}, function(data, status, xhr) {
                        var normalized_data = $.map(data["rows"], function(x){ var cell = $(x["cell"][0]); return {value: cell.text(), url: cell[0].href} });
                        cache[term] = normalized_data;
                        if (xhr !== last_xhr) {
                            response(normalized_data);
                        }
                    });
                },
            });
        });
    </script>

    <script type="text/javascript">

     function resizeText(multiplier) {
      if (document.body.style.fontSize == "") {
        document.body.style.fontSize = ".8em";
      }
      document.body.style.fontSize = parseFloat(document.body.style.fontSize) + (multiplier * 0.2) + "em";
    }
    </script>
    <script type="text/javascript">
     function unhide(divID) {
     var item = document.getElementById(divID);
     if (item) {
     item.className=(item.className=='hidden')?'unhidden':'hidden';
     }
     }
     </script>
     <script type="text/javascript">
    function toggleNewItemMenu(className){
        var menu = "#" + className;
        if ($(menu).is(":hidden")) {
            $(menu).slideDown("slow");
        } else {
            $(menu).slideUp("slow");
        }
    };
    </script>
    <script type="text/javascript">
    function toggleChat(className){
        var chat = "#" + className;
        if ($(chat).is(":hidden")) {
            $(chat).slideDown("slow");
            $("#chat_messages").scrollTop($("#chat_messages")[0].scrollHeight);
            $("#expandChatButton").attr("class", "ui-icon ui-icon-circle-triangle-s");
        } else {
            $(chat).slideUp("slow");
            $("#expandChatButton").attr("class", "ui-icon ui-icon-circle-triangle-n");
        }
    };
    </script>
    {% block head_append %}
    {% endblock %}
</head>

  <body>
    <div id="overall-wrap">
      <div id="overall">

        {% include "includes/adminbar.html" %}

        <div class="site_outer">
        <div class="site_inner" {% if item %}style="width: 97%;"{% endif %}>

        <div class="content_box">

            <table cellspacing="0">
                <tr>
                    <td style="vertical-align: top; width: 15%; padding:0;" id="left_table_column">
                        <div style="margin-bottom: 10px;">
                            <a href="/"><img src="{% media_url "spacer.gif" %}" alt="Deme Logo" style="height: 100px; width: 200px; border: 1px solid #aaa; background-color: #00c; -moz-border-radius: 8px; -webkit-border-radius: 8px;" /></a>
                        </div>
                        <div class="ui-widget-header ui-corner-top ui-helper-clearfix" style="padding: 5px;">
                            Recently Viewed
                        </div>
                        <div class="ui-widget-content ui-corner-bottom ui-helper-clearfix" style="padding: 5px; margin-bottom: 10px;">
                            {% recently_viewed %}
                        </div>
                        <div class="ui-widget-header ui-corner-top ui-helper-clearfix" style="padding: 5px;">
                            Navigation
                        </div>
                        <div class="ui-widget-content ui-corner-bottom ui-helper-clearfix" style="padding: 5px; margin-bottom: 10px;">
                            <ul style="list-style-type: none; margin: 0; padding: 0;">
                                <li{% ifequal full_path "/"%} style="font-weight: bold;"{% endifequal %}><a href="/">Home</a></li>
                                <li{% ifequal action "list" %}{% ifequal viewer_name "item" %} style="font-weight: bold;"{% endifequal %}{% endifequal %}><a href="{% url item_type_url viewer="item" %}">Items</a></li>
                                <li><a href="http://deme.stanford.edu/static/docs/index.html">Docs</a></li>
                            </ul>
                        </div>
                    </td>
                    <td style="vertical-align: top; width: 85%; padding:0;" id="center_table_column">
                        <div style="margin-top: 80px;">
                            {% if layout_permissions_problem %}
                            <div style="color: #a00; padding: 15px; margin: 15px; border: thin dotted #a00; text-align: center;">
                                Permissions Error: You are not authorized to view the layout, so this page is being displayed in the default layout.
                            </div>
                            {% endif %}
                            <table style="margin-bottom: 0;">
                                <tr>
                                    <td style="vertical-align: bottom; padding: 0; padding-left: 5px;" colspan="2">
                                        <div style="clear: both;"></div>
                                        <div class="title">
                                            {% block title %}
                                            {% if item %}
                                            <img src="{{ item.actual_item_type|icon_url:24 }}" title="{% item_type_verbose_name item %}" /> {% viewable_name item %}{% if action_title %} &raquo; {{ action_title }}{% endif %}
                                            {% else %}
                                            <img src="{{ accepted_item_type|icon_url:24 }}" title="{% item_type_verbose_name accepted_item_type %}" /> {% if action_title %}{{ action_title }}{% else %}{{ accepted_item_type_name_plural|capfirst }}{% endif %}
                                            {% endif %}
                                            {% endblock title %}
                                        </div>
                                    </td>
                                </tr>
                            </table>
                            <div style="padding: 0 5px 0 5px;">
                                {% block content %}
                                {% endblock %}
                            </div>
                        </div>
                    </td>
                </tr>
            </table>

        </div>
        <div style="clear: both;"></div>
        <div class ="chat" style="width: 200px; margin: 0; position: fixed; bottom: 0;">
            <div class="ui-widget-header ui-corner-top ui-helper-clearfix" id="chatHeader" style="padding: 5px;">
                Chat
                <a id="expandChat" onclick="toggleChat('chatBody'); return false;" class="fg-button ui-state-default fg-button-icon-solo ui-corner-all" title="Expand_Chat" style="float: right; height: 10px;"><span class="ui-icon ui-icon-circle-triangle-n" id="expandChatButton" style= "height: 20px;"></span>Expand Chat</a>


            </div>
            <div class="ui-widget-content ui-corner-bottom ui-helper-clearfix" id="chatBody" style="padding: 5px; display:none;">
                {% chat_box %}
            </div>
        </div>

        <div class="footer">
            <p>
                <b>Desktop Browser</b>
                {% if item %}
                |
                <a href="{% url item_url viewer=viewer_name,action="show",noun=item.pk,format="rss" %}">RSS</a>
                {% endif %}
                {% ifequal action 'list' %}
                |
                <a href="{% url item_type_url viewer=viewer_name,action="list",format="rss" %}?{{ query_string }}">RSS</a>
                {% endifequal %}
                |
                <a href="#" onclick="resizeText(1); return false;">Increase text size</a>
                |
                <a href="#" onclick="resizeText(-1); return false;">Decrease text size</a>
                |
                <a href="#" id="showhidetrigger">Fullscreen</a>
                |
                <a href="javascript:function Sel(w){var s = '',i=0; try{if (w.getSelection) s = w.getSelection(); else s = w.document.getSelection(); i=w.frames.length; }catch(e){} while (((s == '')||(s == null)) && i--){s=Sel(w.frames[i]);}if (s == null) s='';return ''+s;};function Pop(url,title){win=window.open(url,title,'toolbar=no,width=800,height=600,scrollbars=yes,resizable=yes'); win.focus();};var s=Sel(this);if (s=='') void(s=prompt('Type a word for look up',''));if(s!=null) void(Pop('http://www.wordsmyth.net/?level=3&m=wn&ent='+escape(s), 'w_mini'));" class="wedt"><span>Dictionary/Thesaurus</span></a>
                |
                <a href="#" onclick="$('#google_translate_dialog').dialog({close: function(event, ui) {$('#google_translate_dialog').dialog('destroy')}}); return false;">Translate</a>
                <div id="google_translate_dialog" title="Translate" style="display: none;">
                    <div id="google_translate_element">
                    </div>
                </div>
                <script>
                function googleTranslateElementInit() {
                  new google.translate.TranslateElement({
                    pageLanguage: 'en',
                    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
                  }, 'google_translate_element');
                }
                </script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
            </p>
            <p>Copyright &copy;2008-{% now "Y" %} to Deme | <a href="http://github.com/mikemintz/deme/tree/master">Source Code</a> <span class="pipe">|</span> <a href="http://www.stanford.edu/~davies/">Authors</a> | <a href="{% url item_type_url viewer="item",action="admin" %}">Admin</a> | <a href="{% url item_type_url viewer="item",action="recentchanges" %}">Recent Changes</a></p>
        </div>
          <div id="showhidetarget">

            <p>For Internet Explorer users: Click on the Tools menu, located at the top of your browser window. When the drop-down menu appears, select the option      labeled Full Screen.</p>
            <p>For Chrome users:Click on the Chrome "wrench" icon, located in the upper right hand corner of your browser window. When the drop-down menu appears, select the choice labeled Full Screen.</p>
            <p>For Firefox user:Click on the View menu, located at the top of your browser window. When the drop-down menu appears, select the option labeled Full Screen.</p>
            <p>For Safari users: Safari currently does not support the ability to go fullscreen.</p>
          </div>
        </div>
        </div>

      </div><!-- /#overall -->

      {% if item %}
        {% include "includes/metabar.html" %}
      {% endif %}

    </div><!-- /#overall-wrap -->
  </body>
</html>

