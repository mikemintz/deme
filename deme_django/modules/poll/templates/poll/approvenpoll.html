{% extends layout %}
{% load item_tags %}
{% block content %}
<style>
div {
 margin-right: 5px;
}

div p {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0;
}

#label {
  font-size: 12px;
  font-weight: bold;
  margin: 0;
}

div.Question {
  margin-right: 6em;
}

div.Deadline p{
	font-size: 20px;
}

div.Instructions p{
	font-size: 12px;
}

#No_Permission {
	font-size: 12px;
}

div.submit_button a.poll {
}

div #Results {
    width: 20%;
    padding-left: 1em;
	background-color: #CCF;
	outline: 2px solid black;
	float: right;
}

div.container.propositions div.row.odd span{
	background-color: #CCF;
}

div.container.propositions div.row.even span{
	background-color: #F0F0F0;
}

div.container div.row.even{
	background-color: #F0F0F0;
	height: 3em;
	border: 1px solid gray
}

div.container div.row.odd{
	background-color: #CCF;
	height: 3em;
	border: 1px solid gray
}


div.container.propositions a{
	margin-right: 2em;
}

div.container span span{
	float: right;
	margin-left: 1em;
}

div.container div.implementation{
	height: 16em;
	overflow: hidden;
	margin: 0em;
	display: none;
}

</style>

<script type="text/javascript">
	function toggleImplementation(pk){
		var button = "#hide" + pk;
		var implementation = "#" + pk;
		if ($(implementation).is(":hidden")) {
			$(implementation).slideDown("slow");
			$(button).val(" Hide Details");
		} else {
			$(implementation).slideUp("slow");
			$(button).val("Show Details");
		}
	};
</script>
<script type="text/javascript">
	function toggleResponses(pk){
		var response = "#responses" + pk;
		var button = "#hide" + pk;
		if ($(response).is(":hidden")) {
			$(response).slideDown("slow");
			$(button).val(" Hide Responses");
		} else {
			$(response).slideUp("slow");
			$(button).val("Show Responses");
		}
	};
	
	function toggleButtons(className){
		var buttons = "#" + className;
		if ($(buttons).is(":hidden")) {
			$(buttons).slideDown("slow");
		} else {
			$(buttons).slideUp("slow");
		}
	};
</script>


<div id='Results'>
	<p>View Results<p>
	{% if decisions %}
		{% for decision in decisions %}
			{% ifagentcan 'view Decision.poll' decision %}
	 		<p><a href="{{ decision.get_absolute_url }}">{% viewable_name decision %}</a></p>
			{% endifagentcan %}
		{% endfor %}
	{% else %}
		<p>No Results Yet<p>
	{% endif %}
</div>
<div class='Question'> 
	{% ifagentcan 'view Poll.question' item %}
	<p>{{ item.question }}</p>
	{% else %}
	<p> YOU CANNOT VIEW THIS FIELD </p>
	{% endifagentcan %}
	<p id='label'> Question </p>
</div>
<div class='Deadline'>
	<p>{% ifagentcan 'view Poll.deadline_date' item %} {{ item.deadline_date }} {% endifagentcan %} 
		{% ifagentcan 'view Poll.deadline_time' item %} at {{ item.deadline_time }} {% endifagentcan %} 
	</p>
	<p id='label'> Deadline </p>
</div>
<div class='timezone'>
	<p>{% ifagentcan 'view Poll.time_zone' item %} {{ item.time_zone }} {% endifagentcan %}</p>
	<p id='label'> Timezone </p>
</div>
<div class='Beginning'>
	{% ifagentcan 'view Poll.begins' item %}
	<p>{{ item.begins }}</p>
	{% endifagentcan %}
	<p id='label'> Poll Started </p>
</div>

<br />
<br />
<div class='Instructions'>
	{% ifagentcan 'view ApproveNPoll.n' item %}
	<p style="font-size: 16px;">Approve {{ item.n }} or fewer propositions.</p>
	{% endifagentcan %}
<div>



<script type="text/javascript">
    function openDialog(name)
    {
        var dialogBox = $("#" + name);
        dialogBox.dialog({
            autoOpen: false,
            bgiframe: true,
            modal: true,
            close: function(event, ui) {dialogBox.dialog('destroy')}
        });
        dialogBox.dialog('open');
    }   =me
</script>



{% if propositions %}
<form method="post" enctype="multipart/form-data" 
	action="{% url item_url viewer=viewer_name,action="respondtopropositions",noun=item.pk %}?redirect={{ full_path|urlencode }}">
<div class="container propositions" id="Propcontainer" style="width: 78%; margin-left: 0; ">
    
	
	{% for proposition in propositions %}
    <div class="{% cycle 'even' 'odd' %} row ">
           <div class='description' style="float:left"><span class="row"> <a style="width=100px; overflow:hidden;" href="{{ proposition.get_absolute_url }}?crumb_filter=memberships.collection.{{ item.pk }}">{% viewable_name proposition %}</a><br>
	 {% ifagentcan 'view Proposition.summary_text' proposition %}{{proposition.summary_text}}{% endifagentcan %}</div>
			<div style="float: right">
				{% if cur_agent_in_eligbles %}
				<select name="{{ proposition.pk }}">
	        	<option value="no vote">Not Voted</option>
				<option value="approve">Approve</option>
				<option value="disapprove">Disapprove</option>
				</select> 
				{% endif %}
			<input type="button" value="Show Details" id="hide{{ proposition.pk }}" onclick="toggleImplementation('{{ proposition.pk }}')" /></div><div style="clear: both;"></div></span></div>
			
    <div class="implementation"id="{{ proposition.pk }}">
	<a href="{{ proposition.get_absolute_url }}">View as an item</a>{{proposition.body|safe}} 
	</div>
    {% endfor %}
{% if cur_agent_in_eligbles %}
<div style="margin-left:40%; margin-bottom:1em;">
    <input type="submit" value="Submit" /><br><br>
</div>
{% endif %}
</div>
</form>
{% else %}
    No propositions in this poll
{% endif %}
<br />



{% ifagentcan 'modify_membership' item %}
<div class="submit_button">  
	<a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" onclick="toggleButtons('hiddenPropositionButtons')">Add a Proposition</a>
</div>
{% endifagentcan %}

{% if cur_agent_can_make_a_decision %}
<div class="submit_button" id="NewDecision" style="margin-left:5em;">
    <a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" onclick="toggleButtons('hiddenDecisionButtons')">Calculate Result</a>
</div>
{% endif %}
<br />
<br />
{# NEED TO MAKE THIS IFAGENTCAN CREATE PROPOSITION AND MODIFY MEMBERSHIP(WHICH IT ALREADY IS CHECKING) #}
<div id="hiddenPropositionButtons" style="margin: 4px; height 2em; display:none;">
	{% ifagentcanglobal 'create Proposition' %}
	 <a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" href="{% url item_type_url viewer='proposition',action='new'%}?populate_poll={{ item.pk }}&amp;add_to_collection={{ item.pk }}&amp;redirect={{ full_path|urlencode }}">Make New Proposition</a>
	{% endifagentcanglobal %}
	{% ifagentcan 'modify_membership' item %}
	<a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" onclick="openDialog('addmember{{ item.pk }}'); return false;">Add Existing Proposition to Poll</a>
	{% endifagentcan %}
	<a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" onclick="toggleButtons('hiddenPropositionButtons')">Cancel</a><br><br>
</div>

<div id="hiddenDecisionButtons" style="margin: 4px; height 5em; display: none;">
	{% ifagentcanglobal 'create PluralityApproveNDecision' %} 
	<a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" href="{% url item_type_url viewer='pluralityapprovendecision',action='new'%}?populate_poll={{ item.pk }}&amp;redirect={{ full_path|urlencode }}">
		New Plurality Aggregation</a>
	{% endifagentcanglobal %}
	{% ifagentcanglobal 'create ThresholdApproveNDecision' %}
	 <a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" href="{% url item_type_url viewer='thresholdapprovendecision',action='new'%}?populate_poll={{ item.pk }}&amp;redirect={{ full_path|urlencode }}">New Threshold Aggregation</a>
	{% endifagentcanglobal %}
	{% ifagentcanglobal 'create ThresholdEApproveNDecision' %}
	 <a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" href="{% url item_type_url viewer='thresholdeapprovendecision',action='new'%}?populate_poll={{ item.pk }}&amp;redirect={{ full_path|urlencode }}">New ThresholdE Aggregation</a>
	{% endifagentcanglobal %}
	<a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all poll" onclick="toggleButtons('hiddenDecisionButtons')">Cancel</a><br><br>
</div>

<br />
<br />
<br />
<p style="font-size:16px;">Responses:</p>
{# make this a bulleted list with hidden divs #}
<div class="container responses" id="Propcontainer" style="width: 60%; margin-left: 0;">
    {% if can_view_response_names_and_values %}
        {% for key,value in responses.items %}
        	<div class="{% cycle 'even' 'odd' %} row " >
        	<span class="row"><a href="{{ key.get_absolute_url }}">{% viewable_name key %}</a>
     		{% if value %}
            	has responded 
                <input type="button" style="float:right;"
                value="Show Responses" id="hide{{ key.pk }}" onclick="toggleResponses('{{ key.pk }}')" />
				</div>
               	<div id="responses{{ key.pk }}" style="display: none">
                {% for response in value %}
                     <p><a href="{{ response.proposition.get_absolute_url }}" style="margin-left:1em;">
                     {% viewable_name response.proposition %}</a>: {{ response.value }}</p>
                {% endfor %}
                </div></span>
        	{% else %}
            	has not responded </span></div>
        	{% endif %}
        {% endfor %}
	</div>
    {% else %}{% if can_view_response_names %}
	{% for key,value in responses.items %}
    <div class="{% cycle 'even' 'odd' %} row " >
    <span class="row"><a href="{{ key.get_absolute_url }}">{% viewable_name key %}</a>
    {% if value %} has responded {% else %} has not responded {% endif %}
	{% ifequal cur_agent key %} 
		<input type="button" style="float:right;"
        value="Show Responses" id="hide{{ key.pk }}" onclick="toggleResponses('{{ key.pk }}')" />
		</div>
       	<div id="responses{{ key.pk }}" style="display: none">
        {% for response in value %}
             <p><a href="{{ response.proposition.get_absolute_url }}" style="margin-left:1em;">
             {% viewable_name response.proposition %}</a>: {{ response.value }}</p>
        {% endfor %}
	{% endifequal %}
    </span></div>
    {% endfor %}
    {% else %}
		Responses are not visible
		<p>You're response:</p>
		 {% for key,value in responses.items %}
			
			{% ifequal cur_agent.pk key.pk %}
	        	<div class="{% cycle 'even' 'odd' %} row " >
	        	<span class="row"><a href="{{ key.get_absolute_url }}">{% viewable_name key %}</a>
	     		{% if value %}
	            	has responded 
	                <input type="button" style="float:right;"
	                value="Show Responses" id="hide{{ key.pk }}" onclick="toggleResponses('{{ key.pk }}')" />
					</div>
	               	<div id="responses{{ key.pk }}" style="display: none">
	                {% for response in value %}
	                     <p><a href="{{ response.proposition.get_absolute_url }}" style="margin-left:1em;">
	                     {% viewable_name response.proposition %}</a>: {{ response.value }}</p>
	                {% endfor %}
	                </div></span>
	        	{% else %}
	            	has not responded </span></div>
	        	{% endif %}
			{% endifequal %}
	       {% endfor %}
    {% endif %}{% endif %}
</div>






{% endblock content %}

