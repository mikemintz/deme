{% extends layout %}
{% load item_tags %}
{% block content %}
<script type="text/javascript">
function showDialog(){
   $("#divId").dialog("open");
   return false;
}

$(document).ready(function() {
   $("#divId").dialog({
           autoOpen: false,
           modal: true,
           height: 500,
           width: 500
       });
});
</script>
<script type="text/javascript">
	function toggleImplementation(pk){
		var button = "#hide" + pk;
		var implementation = "#" + pk;
		if ($(implementation).is(":hidden")) {
			$(implementation).slideDown("slow");
			$(button).val(" Hide Details");
		} else {
			$(implementation).slideUp("slow");
			$(button).val("Show Details");
		}
	};
</script>
<script type="text/javascript">
	function toggleResponses(pk){
		var response = "#responses" + pk;
		var button = "#hide" + pk;
		if ($(response).is(":hidden")) {
			$(response).slideDown("slow");
			$(button).val(" Hide Responses");
		} else {
			$(response).slideUp("slow");
			$(button).val("Show Responses");
		}
	};

	function toggleButtons(className){
		var buttons = "#" + className;
		if ($(buttons).is(":hidden")) {
			$(buttons).slideDown("slow");
		} else {
			$(buttons).slideUp("slow");
		}
	};

	function removeMember(pk){
		$("#removeInput").val(pk);
		$("#removemember").submit();
	};
</script>

<div class="approvenpoll">
  {% if can_view_response_names_and_values or not cur_agent_has_voted %}

    <script type="text/javascript">
        function openDialog(name)
        {
            var dialogBox = $("#" + name);
            dialogBox.dialog({
                autoOpen: false,
                bgiframe: true,
                modal: true,
                close: function(event, ui) {dialogBox.dialog('destroy')}
            });
            dialogBox.dialog('open');
        }
    </script>
    <form id="removemember" style="display: inline;" method="post" enctype="multipart/form-data" action="{% url item_url viewer=viewer_name,action="removemember",noun=item.pk %}?redirect={{ full_path|urlencode }}" class="item_form">
      <input id="removeInput"type="hidden" name="item" value="{{ membership.item.pk }}" />
    </form>

    {% if item.question %}
    <p class="issue">
    <strong>Issue:</strong>
    {{ item.question }}
    </p>
    {% endif %}

    <div class="row">

      <!-- Start Propositions -->
      {% ifagentcan 'modify_membership' item %}
      <!-- admin -->
      <div class="col-span-6 propositions-container">
      <h3>Propositions</h3>
      {% endifagentcan %}

      {% if propositions %}
        <form method="post" enctype="multipart/form-data"
            	action="{% url item_url viewer=viewer_name,action="respondtopropositions",noun=item.pk %}?redirect={{ full_path|urlencode }}">
        	<div class="propositions list-group" id="Propcontainer">
      		{% for proposition in propositions %}
    		    <div class="proposition list-group-item">
    		      <h4>{% firstof proposition.name forloop.counter %}</h4>
    		      <p>{{proposition.body|safe}}</p>

     		 	    {% ifagentcan 'modify_membership' item %}
    	 	      <!-- admin -->
        			<button class="btn btn-small" type="button" onclick="removeMember('{{ proposition.pk }}')"><i class="glyphicon glyphicon-trash"></i> Remove</button>
        		  {% endifagentcan %}

        			{% if cur_agent_in_eligbles %}
        			<label class="radio-inline">
        				<input type="radio" name="{{ proposition.pk }}" value="approve"> Agree
        			</label>
        			<label class="radio-inline">
        				<input type="radio" name="{{ proposition.pk }}" value="disapprove"> Disagree
        			</label>
        			{% endif %}
      			</div>

    	    {% endfor %}
          </div><!-- /#Propcontainer -->

        	{% if cur_agent_in_eligbles %}
            <!--
        	<p><strong>You also have the option of writing in your own statement that you think better captures your opinions. We ask that you still vote for each response above and then write your own statement here:</strong><p>
        	<textarea  name="optional_writein_comment" type="text" cols="20" rows="2"></textarea><br />
            -->
            <input type="hidden" name="optional_writein_comment" value="" />

            <p>
              <button type="submit" class="btn btn-primary">Submit</button>
            </p>

        	{% endif %}

        </form>
        {% else %}
        <div class="alert">No propositions in this poll</div>
      {% endif %}<!--(propositions)-->

      {% ifagentcan 'modify_membership' item %}
      <!-- admin -->
      <p>
        {% ifagentcanglobal 'create Proposition' %}
      	<a class="btn" href="{% url item_type_url viewer='proposition',action='new'%}?populate_poll={{ item.pk }}&amp;add_to_collection={{ item.pk }}&amp;redirect={{ full_path|urlencode }}">Add a Proposition</a>
      	{% endifagentcanglobal %}
      	{% ifagentcan 'modify_membership' item %}
      	<!--a class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" onclick="openDialog('addmember{{ item.pk }}'); return false;">Add Existing Proposition to Poll</a-->
      	{% endifagentcan %}
      </p>
      </div><!-- /.col-span-6 -->
      {% endifagentcan %}
      <!-- End Propositions -->

      {% if can_view_response_names_and_values %}
      <div class="col-span-6 responses-container">
        {% for key, value in responses.items %}
        	<div class="response">
        	  <a href="{{ key.get_absolute_url }}">{% viewable_name key %}</a>
        	  {% if value %}
            	has responded

              <input type="button" style="float:right;"
                value="Show Responses" id="hide{{ key.pk }}" onclick="toggleResponses('{{ key.pk }}')" />

              <div id="responses{{ key.pk }}" style="display: none">
                {% for response in value %}
                     <p><a href="{{ response.proposition.get_absolute_url }}">
                     {% viewable_name response.proposition %}</a>:
	                     {%ifequal response.value "approve" %}
	                     	Agree
	                     {% endifequal %}
	                     {%ifequal response.value "disapprove" %}
	                     	Disagree
	                     {% endifequal %}
	                   </p>
                {% endfor %}
              </div>
        	  {% else %}
            	has not responded
          	{% endif %}
        	</div>
        {% endfor %}
      </div>
      {% endif %}<!--(can_view_response_names_and_values)-->

    </div><!-- .row -->
  {% endif %}<!--(can_view_response_names_and_values or not cur_agent_has_voted)-->

  {% if cur_agent_has_voted or can_view_response_names_and_values %}
  <div class="row">
    <div class="panel">
      <h3 class="panel-heading">Poll Results</h3>
      {% for dict in vote_numbers_list %}
      {% with dict.proposition as proposition %}
      <div class="proposition proposition-result">
        <h4>{% firstof proposition.name forloop.counter %}</h4>
	      <p>{{proposition.body|safe}}</p>
	      <table class="Poll" border="0"  >

			  <tr>
			    <td width = "70px" align="right">{{dict.agree}} Agree</td>
			    <td></td>
			    {% for i in dict.n %}
			    	{% if i < dict.agree %}
			    		<td bgcolor="blue" width="{{ proportion }}px" style="padding:0"></td>
			    		<td bgcolor="blue" width="{{ proportion }}px" style="padding:0"></td>
			    	{% endif %}
			    {% endfor %}
			  </tr>
			  <tr height = "5px"></tr>
			  <tr>
			    <td align="right">{{dict.disagree}} Disagree</td>
			    <td></td>
			    {% for i in dict.n %}
			    	{% if i < dict.disagree %}
			    		<td bgcolor="blue" width="{{ proportion }}px" style="padding:0"></td>
			    		<td bgcolor="blue" width="{{ proportion }}px" style="padding:0"></td>
			    	{% else %}
			    		<td  width="{{ proportion }}px" style="padding:0"></td>
			    		<td  width="{{ proportion }}px" style="padding:0"></td>
			    	{% endif %}
			    {% endfor %}
			  </tr>
			  <tr height = "5px"></tr>
			  <tr>
			    <td align="right">{{dict.no_vote}} Haven't Voted</td>
			    <td></td>
			    {% for i in dict.n %}
			    	{% if i < dict.no_vote %}
			    		<td bgcolor="blue" width="{{ proportion }}px" style="padding:0"></td>
			    		<td bgcolor="blue" width="{{ proportion }}px" style="padding:0"></td>
			    	{% endif %}
			    {% endfor %}
			  </tr>
			  <tr margin='0' style="padding:0" height="1em">
			  	<td style="padding:0; margin:0;" height="1em"></td>
			  	<td style="padding:0; margin:0;" height="1em"></td>
			  	{% for i in rangeN %}
			  		<td style="padding:0; margin:0;" height="1em" border-right:"1">|</td>
			  		<td style="padding:0; margin:0;" height="1em"></td>
			  	{% endfor %}
			  </tr>
			  <tr margin='0' style="padding:0" height="1em">
			    <th width = "150px">Responses</th>
			    <th width = "5px"></th>
			    {% for i in rangeN %}
			    	<th width = "{{ 2proportion }}"colspan="2" height="1em" style="padding-left:0">{{i}}</th>
			    {% endfor %}
			  </tr>
			</table>
      </div>
      {% endwith %}
      {% endfor %}

      <hr>

      <div class="personal-statements">
        <h4>Personal Statements</h4>
        {% if comments %}
        	<table>
    	    {% for comment in comments %}
    	    <tr>
    	    	<td>{{ comment.body|safe }}</td>
    	    	<td>Posted on {{ comment.created_at }}</td>
    	    </tr>
    	    {% endfor %}
    	    </table>
      	{% else %}
      		<p>There have been no personal statements made</p>
      	{% endif %}
      </div>

      {% if cur_agent_in_eligbles %}
      <div class="panel">
      	<h5 class="panel-heading">Add a personal statement:</h5>
      	<form method="post" enctype="multipart/form-data"
      	action="{% url item_url viewer=viewer_name,action="addawritein",noun=item.pk %}?redirect={{ full_path|urlencode }}">
      	  <p><textarea name="optional_writein_comment" type="text" cols="20" rows="2"></textarea></p>
      	  <p><input type="submit" value="Comment" class="btn btn-primary"></p>
      	</form>
      </div>
    	{% endif %}

    </div><!--/.panel-->
  </div><!--/.row-->
  {% endif %}<!--(cur_agent_has_voted or can_view_response_names_and_values)-->
</div><!--/.approvenpoll-->





{% endblock content %}


<!------------------------------------------------------------------------>


{% if cur_agent_has_voted or can_view_response_names_and_values %}



	{% if cur_agent_in_eligbles %}
	<p><strong>Add a personal statement:</strong><p>
	<form method="post" enctype="multipart/form-data"
	action="{% url item_url viewer=viewer_name,action="addawritein",noun=item.pk %}?redirect={{ full_path|urlencode }}">
	<textarea  name="optional_writein_comment" type="text" cols="20" rows="2"></textarea><br />
			<div style="margin-left:40%; margin-bottom:1em;">
			    <input type="submit" value="Submit" /><br><br>
			</div>
	</form>
	{% endif %}

    {% if can_view_response_names_and_values %}
    <h3>-------Admin View--------</h3>


<p style="font-size:16px;">Responses:</p>
{# make this a bulleted list with hidden divs #}
<div class="container responses" id="Propcontainer" style="width: 60%; margin-left: 0;">
    {% if can_view_response_names_and_values %}
        {% for key,value in responses.items %}
        	<div class="{% cycle 'even' 'odd' %} row " >
        	<span class="row"><a href="{{ key.get_absolute_url }}">{% viewable_name key %}</a>
     		{% if value %}
            	has responded
                <input type="button" style="float:right;"
                value="Show Responses" id="hide{{ key.pk }}" onclick="toggleResponses('{{ key.pk }}')" />
				</div>

               	<div id="responses{{ key.pk }}" style="display: none">
                {% for response in value %}
                     <p><a href="{{ response.proposition.get_absolute_url }}" style="margin-left:1em;">
                     {% viewable_name response.proposition %}</a>:
	                     {%ifequal response.value "approve" %}
	                     	Agree
	                     {% endifequal %}
	                     {%ifequal response.value "disapprove" %}
	                     	Disagree
	                     {% endifequal %}
	                     </p>
                {% endfor %}
                </div></span>
        	{% else %}
            	has not responded </span></div>
        	{% endif %}
        {% endfor %}
	</div>
    {% else %}{% if can_view_response_names %}
	{% for key,value in responses.items %}
    <div class="{% cycle 'even' 'odd' %} row " >
    <span class="row"><a href="{{ key.get_absolute_url }}">{% viewable_name key %}</a>
    {% if value %} has responded {% else %} has not responded {% endif %}
	{% ifequal cur_agent key %}
		<input type="button" style="float:right;"
        value="Show Responses" id="hide{{ key.pk }}" onclick="toggleResponses('{{ key.pk }}')" />
		</div>

       	<div id="responses{{ key.pk }}" style="display: none">
        {% for response in value %}
             <p><a href="{{ response.proposition.get_absolute_url }}" style="margin-left:1em;">
             {% viewable_name response.proposition %}</a>: {{ response.value }}</p>
        {% endfor %}
	{% endifequal %}
    </span></div>
    {% endfor %}
    {% else %}
		Responses are not visible
		<p>Your response:</p>
		 {% for key,value in responses.items %}

			{% ifequal cur_agent.pk key.pk %}
	        	<div class="{% cycle 'even' 'odd' %} row " >
	        	<span class="row"><a href="{{ key.get_absolute_url }}">{% viewable_name key %}</a>
	     		{% if value %}
	            	has responded
	                <input type="button" style="float:right;"
	                value="Show Responses" id="hide{{ key.pk }}" onclick="toggleResponses('{{ key.pk }}')" />
					</div>
	               	<div id="responses{{ key.pk }}" style="display: none">
	                {% for response in value %}
	                     <p><a href="{{ response.proposition.get_absolute_url }}" style="margin-left:1em;">
	                     {% viewable_name response.proposition %}</a>:

	                     {%ifequal response.value approve %}
	                     	Agree
	                     {% endifequal %}
	                     {%ifequal response.value "disapprove" %}
	                     	Disagree
	                     {% endifequal %}
	                     </p>
	                {% endfor %}
	                </div></span>
	        	{% else %}
	            	has not responded </span></div>
	        	{% endif %}
			{% endifequal %}
	       {% endfor %}
    {% endif %}{% endif %}
</div>


	{% endif %}

{% endif %}

</div>

